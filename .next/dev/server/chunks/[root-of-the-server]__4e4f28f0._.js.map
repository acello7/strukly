{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/kimoc/OneDrive/Desktop/KolosalAProject/strukly/app/api/chat/route.ts"],"sourcesContent":["// app/api/chat/route.ts\r\nimport { NextResponse } from \"next/server\";\r\n\r\nconst API_KEY = process.env.GEMINI_API_KEY;\r\n// Gunakan model yang sama karena terbukti tersedia di akunmu\r\nconst MODEL_NAME = \"gemini-2.0-flash\";\r\nconst MODEL_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent`;\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const { message, history } = body; // Menerima pesan & history dari frontend\r\n\r\n    if (!message) {\r\n      return NextResponse.json({ error: \"Message required\" }, { status: 400 });\r\n    }\r\n\r\n    // 1. Instruksi kepribadian Bot\r\n    const systemPrompt = {\r\n      role: \"user\",\r\n      parts: [{ text: `\r\n        You are Strukly AI, a helpful assistant for a receipt management app.\r\n        Language: Indonesian (Bahasa Indonesia).\r\n        Tone: Friendly, concise, helpful.\r\n        Capabilities: Help users upload receipts, explain features, and troubleshoot errors.\r\n      `}]\r\n    };\r\n\r\n    const modelAck = {\r\n      role: \"model\",\r\n      parts: [{ text: \"Siap! Saya Strukly AI yang akan membantu pengguna dengan ramah.\" }]\r\n    };\r\n\r\n    // 2. Format History Chat (ubah format frontend ke format Gemini)\r\n    const formattedHistory = history.map((msg: any) => ({\r\n      role: msg.sender === \"user\" ? \"user\" : \"model\",\r\n      parts: [{ text: msg.text }]\r\n    }));\r\n\r\n    // 3. Gabungkan semua konteks\r\n    const contents = [\r\n      systemPrompt,\r\n      modelAck,\r\n      ...formattedHistory,\r\n      { role: \"user\", parts: [{ text: message }] }\r\n    ];\r\n\r\n    // 4. Kirim ke Gemini\r\n    const res = await fetch(`${MODEL_URL}?key=${API_KEY}`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ contents })\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const errorText = await res.text();\r\n      console.error(\"Chat API Error:\", errorText);\r\n      return NextResponse.json({ response: \"Maaf, saya sedang pusing. Coba lagi nanti ya.\" }, { status: 500 });\r\n    }\r\n\r\n    const data = await res.json();\r\n    const reply = data.candidates?.[0]?.content?.parts?.[0]?.text;\r\n\r\n    return NextResponse.json({ response: reply });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Chat Server Error:\", error);\r\n    return NextResponse.json({ response: \"Terjadi kesalahan sistem.\" }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":"AAAA,wBAAwB;;;;;AACxB;;AAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,cAAc;AAC1C,6DAA6D;AAC7D,MAAM,aAAa;AACnB,MAAM,YAAY,CAAC,wDAAwD,EAAE,WAAW,gBAAgB,CAAC;AAElG,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,MAAM,yCAAyC;QAE5E,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,+BAA+B;QAC/B,MAAM,eAAe;YACnB,MAAM;YACN,OAAO;gBAAC;oBAAE,MAAM,CAAC;;;;;MAKjB,CAAC;gBAAA;aAAE;QACL;QAEA,MAAM,WAAW;YACf,MAAM;YACN,OAAO;gBAAC;oBAAE,MAAM;gBAAkE;aAAE;QACtF;QAEA,iEAAiE;QACjE,MAAM,mBAAmB,QAAQ,GAAG,CAAC,CAAC,MAAa,CAAC;gBAClD,MAAM,IAAI,MAAM,KAAK,SAAS,SAAS;gBACvC,OAAO;oBAAC;wBAAE,MAAM,IAAI,IAAI;oBAAC;iBAAE;YAC7B,CAAC;QAED,6BAA6B;QAC7B,MAAM,WAAW;YACf;YACA;eACG;YACH;gBAAE,MAAM;gBAAQ,OAAO;oBAAC;wBAAE,MAAM;oBAAQ;iBAAE;YAAC;SAC5C;QAED,qBAAqB;QACrB,MAAM,MAAM,MAAM,MAAM,GAAG,UAAU,KAAK,EAAE,SAAS,EAAE;YACrD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAS;QAClC;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,YAAY,MAAM,IAAI,IAAI;YAChC,QAAQ,KAAK,CAAC,mBAAmB;YACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,UAAU;YAAgD,GAAG;gBAAE,QAAQ;YAAI;QACxG;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,QAAQ,KAAK,UAAU,EAAE,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE;QAEzD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,UAAU;QAAM;IAE7C,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,UAAU;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF"}}]
}